<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laporan Kas Curing2 Grup C</title>

<style>
body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0;padding:16px}
.header{background:linear-gradient(90deg,#0d6efd,#ffc107);color:#fff;padding:16px;text-align:center;border-radius:12px;font-size:20px;font-weight:bold;margin-bottom:16px}
.card{background:#fff;padding:16px;border-radius:12px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#eee}
.masuk{color:green;font-weight:bold}
.keluar{color:red;font-weight:bold}
.hidden{display:none}
</style>
</head>

<body onload="initApp()">

<div class="header">LAPORAN KAS CURING2 GRUP C</div>

<div class="card">
  <h3>Rekap Bulanan</h3>
  <select id="filterBulan" onchange="render()"></select>
</div>

<div class="card">
  <h3>Data Transaksi</h3>
  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Jenis</th>
        <th>Nama</th>
        <th>Ket</th>
        <th>Jumlah</th>
      </tr>
    </thead>
    <tbody id="tabelData"></tbody>
  </table>
</div>

<div class="card">
  <h3>Ringkasan</h3>
  <p>Total Masuk: <b id="totalMasuk"></b></p>
  <p>Total Keluar: <b id="totalKeluar"></b></p>
  <p>Saldo: <b id="saldo"></b></p>
</div>

<div class="card">
  <h3>Status Pembayaran Member</h3>
  <ul id="statusMember"></ul>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbwvS5vGbP2jml484bsAIFD0ntQHr5HInhSYyKyMEmcudJsv2Vk7yqOTmzYbXcL9En-3aQ/exec";

const members=[
  'Ade Hilman','Sutanto','Joko P','Suyatno','Dwi Diva','Zaenal A',
  'Syarifudin','Wahyudi','Afif','Zuhri','Effendi','Susilo A',
  'Slamet R','Aji Joko','A.Febri','Kuswanto','Adhi M'
];

let data=[];

function formatTanggal(t){
  const d=new Date(t);
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,'0');
  const day=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

async function initApp(){
  const res=await fetch(API_URL);
  data=await res.json();
  initBulan();
  render();
}

function initBulan(){
  const set=new Set();
  data.forEach(t=>set.add(formatTanggal(t.tanggal).substring(0,7)));
  filterBulan.innerHTML='<option value="">Semua Bulan</option>';
  [...set].sort().forEach(b=>filterBulan.innerHTML+=`<option>${b}</option>`);
}

function render(){
  tabelData.innerHTML="";
  statusMember.innerHTML="";
  let masuk=0,keluar=0;
  const bulan=filterBulan.value;

  const filtered=data.filter(t=>!bulan||formatTanggal(t.tanggal).startsWith(bulan));

  filtered.forEach(t=>{
    if(t.jenis==="Masuk") masuk+=t.jumlah;
    else keluar+=t.jumlah;

    tabelData.innerHTML+=`
      <tr>
        <td>${formatTanggal(t.tanggal)}</td>
        <td class="${t.jenis==='Masuk'?'masuk':'keluar'}">${t.jenis}</td>
        <td>${t.member}</td>
        <td>${t.keterangan||''}</td>
        <td>Rp ${t.jumlah.toLocaleString('id-ID')}</td>
      </tr>`;
  });

  members.forEach(n=>{
    const paid=filtered.some(t=>t.jenis==="Masuk"&&t.member===n);
    statusMember.innerHTML+=`
      <li>${n} : ${paid?'✅ Sudah bayar':'❌ Belum bayar'}</li>`;
  });

  totalMasuk.innerText="Rp "+masuk.toLocaleString('id-ID');
  totalKeluar.innerText="Rp "+keluar.toLocaleString('id-ID');
  saldo.innerText="Rp "+(masuk-keluar).toLocaleString('id-ID');
}
</script>

</body>
</html>
